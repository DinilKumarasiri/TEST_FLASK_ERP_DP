{% extends "base.html" %}

{% block title %}My Barcode - Mobile Shop ERP{% endblock %}

{% block extra_css %}
<style>
    .barcode-container {
        max-width: 500px;
        margin: 0 auto;
    }
    
    .barcode-card {
        text-align: center;
        padding: 30px;
        border-radius: 15px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .barcode-image {
        margin: 20px auto;
        padding: 20px;
        background: white;
        border-radius: 10px;
        border: 2px dashed #dee2e6;
    }
    
    .barcode-number {
        font-family: 'Courier New', monospace;
        font-size: 24px;
        letter-spacing: 2px;
        background: white;
        padding: 10px 20px;
        border-radius: 8px;
        margin: 20px auto;
        display: inline-block;
        border: 2px solid #4361ee;
    }
    
    .scan-instructions {
        background: #e7f1ff;
        border-left: 4px solid #4361ee;
        padding: 15px;
        border-radius: 8px;
        margin: 30px 0;
        text-align: left;
    }
    
    .instruction-step {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .step-number {
        width: 30px;
        height: 30px;
        background: #4361ee;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        font-weight: bold;
    }
    
    .print-btn {
        background: linear-gradient(135deg, #4361ee, #3a0ca3);
        border: none;
        color: white;
        padding: 12px 30px;
        font-size: 16px;
        border-radius: 10px;
        transition: all 0.3s;
    }
    
    .print-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
    }
    
    @media print {
        .no-print {
            display: none !important;
        }
        
        .barcode-card {
            box-shadow: none;
            border: 2px solid #000;
        }
        
        .scan-instructions {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="barcode-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-id-card me-2"></i>My Barcode ID</h2>
        <div class="btn-group">
            <button class="btn btn-outline-primary no-print" onclick="window.print()">
                <i class="fas fa-print me-1"></i> Print
            </button>
            <a href="{{ url_for('employee.employee_detail', employee_id=current_user.id) }}" 
               class="btn btn-outline-secondary ms-2 no-print">
                <i class="fas fa-user me-1"></i> My Profile
            </a>
        </div>
    </div>
    
    <div class="barcode-card">
        <!-- Employee Information -->
        <div class="mb-4">
            <div class="employee-avatar mx-auto" style="width: 80px; height: 80px; font-size: 32px;">
                {{ current_user.username[:1]|upper }}
            </div>
            <h3 class="mt-3 mb-1">{{ employee_profile.full_name }}</h3>
            <p class="text-muted mb-0">{{ current_user.username }} â€¢ {{ current_user.email }}</p>
            <div class="mt-2">
                <span class="badge bg-primary">{{ employee_profile.department|title if employee_profile.department else 'Employee' }}</span>
                <span class="badge bg-secondary ms-2">{{ current_user.role|title }}</span>
            </div>
        </div>
        
        <!-- Barcode Number -->
        <div class="mb-4">
            <h6 class="text-muted mb-3">Employee Barcode Number</h6>
            <div class="barcode-number" id="barcodeNumber">
                {{ employee_profile.employee_barcode }}
            </div>
            <small class="text-muted">Unique ID for attendance tracking</small>
        </div>
        
        <!-- Barcode Image -->
        <div class="barcode-image">
            {% if employee_profile.barcode_image %}
            <img src="{{ employee_profile.barcode_image }}" 
                 alt="Employee Barcode" 
                 style="max-width: 100%; height: auto;">
            {% else %}
            <div class="text-center py-5">
                <i class="fas fa-barcode fa-4x text-muted mb-3"></i>
                <p class="text-muted mb-0">Barcode image will be generated automatically</p>
                <small class="text-muted">Refresh page if image doesn't appear</small>
            </div>
            {% endif %}
        </div>
        
        <!-- Scan Statistics -->
        <div class="mt-4">
            <div class="row text-center">
                <div class="col-4">
                    <h4 class="mb-1">{{ employee_profile.barcode_scans_count or 0 }}</h4>
                    <small class="text-muted">Total Scans</small>
                </div>
                <div class="col-4">
                    <h4 class="mb-1">{{ employee_profile.barcode_generated_at.strftime('%Y-%m-%d') if employee_profile.barcode_generated_at else 'N/A' }}</h4>
                    <small class="text-muted">Generated On</small>
                </div>
                <div class="col-4">
                    <h4 class="mb-1">{{ employee_profile.employee_code or 'N/A' }}</h4>
                    <small class="text-muted">Employee Code</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scan Instructions -->
    <div class="scan-instructions mt-4">
        <h6 class="mb-3"><i class="fas fa-info-circle me-2"></i>How to Use Your Barcode</h6>
        
        <div class="instruction-step">
            <div class="step-number">1</div>
            <div>Present this barcode to the scanner at the front desk</div>
        </div>
        
        <div class="instruction-step">
            <div class="step-number">2</div>
            <div>Scan once in the morning for check-in (before 10 AM)</div>
        </div>
        
        <div class="instruction-step">
            <div class="step-number">3</div>
            <div>Scan again in the evening for check-out (after 5 PM)</div>
        </div>
        
        <div class="instruction-step">
            <div class="step-number">4</div>
            <div>Your attendance will be recorded automatically</div>
        </div>
        
        <div class="instruction-step">
            <div class="step-number">5</div>
            <div>Contact admin if barcode doesn't scan properly</div>
        </div>
    </div>
    
    <!-- Important Notes -->
    <div class="alert alert-warning mt-4 no-print">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <strong>Important:</strong> This barcode is for your personal use only. 
        Do not share or duplicate it. Report lost/damaged barcodes to administration immediately.
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-refresh barcode image if not loaded
    const barcodeImg = document.querySelector('.barcode-image img');
    if (barcodeImg && !barcodeImg.src.includes('data:image')) {
        setTimeout(() => {
            barcodeImg.src = barcodeImg.src + '&t=' + new Date().getTime();
        }, 2000);
    }
    
    // Print functionality
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'p') {
            e.preventDefault();
            window.print();
        }
    });
    
    // Copy barcode number to clipboard
    const barcodeNumber = document.getElementById('barcodeNumber');
    barcodeNumber.addEventListener('click', function() {
        const text = this.textContent.trim();
        navigator.clipboard.writeText(text).then(() => {
            const originalText = this.textContent;
            this.textContent = 'Copied!';
            setTimeout(() => {
                this.textContent = originalText;
            }, 2000);
        });
    });
});
</script>
{% endblock %}